# v0.1.3-conversation

外部AI会話ログ（conversation.jsonl）の保存・閲覧機能。

## Added

### Backend (infra-automation)

- **conversation_logger.py**: 外部AI会話ログ記録ユーティリティ
  - `append_conversation()`: run_id 指定で JSONL 追記
  - `log_request_response()`: リクエスト/レスポンス一括ログ
  - `set_current_run_id()`: スレッドローカルで run_id 管理

- **openai_adapter.py**: 外部AI呼び出しにログ記録を追加
  - `format_task_for_execution()`: タスク整形時の会話
  - `summarize_execution_log()`: ログ要約時の会話
  - `generate_progress_summary()`: 進捗サマリー生成時の会話

- **ResultLogger**: conversation.jsonl を artifacts/hashes に含める
  - 存在する場合のみ（任意 artifact）

- **verify-runs.py**: 任意 artifact 対応
  - conversation.jsonl, patch.diff は任意
  - hash に含まれているのに存在しない場合は WARN

### Frontend (ai-update-radar)

- **/runs/[run_id]**: Conversation タブ追加
  - JSONL パースして表示
  - role ごとのスタイリング（user: 青, assistant: 緑, system: グレー）
  - model, tokens_in, tokens_out 表示

## フォーマット

```jsonl
{"ts":"...","role":"system","source":"openai","event":"start","meta":{"model":"gpt-4.1-mini"}}
{"ts":"...","role":"system","source":"openai","content":"..."}
{"ts":"...","role":"user","source":"openai","content":"..."}
{"ts":"...","role":"assistant","source":"openai","content":"...","meta":{"tokens_in":123,"tokens_out":456}}
{"ts":"...","role":"system","source":"openai","event":"end","meta":{"status":"ok"}}
```

## 保存場所

```
logs/runs/{run_id}/
├── result.json
├── stdout.log
├── stderr.log
├── patch.diff        (任意)
└── conversation.jsonl (任意 - 外部AI相談があった場合)
```

## Commits

### infra-automation
- `bc2680d` feat(conversation): add external AI conversation logging

### ai-update-radar
- `1f2f9c7` feat(ui): add Conversation tab to run detail page
