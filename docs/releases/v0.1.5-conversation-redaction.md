# v0.1.5-conversation-redaction

会話ログのシークレット/PII自動マスキング機能。

## Added

### infra-automation

- **secrets_masker.py**: シークレット/PIIマスキングモジュール
  - `mask_secrets()`: テキスト内のシークレットをマスク
  - `mask_dict_values()`: 辞書内の値を再帰的にマスク
  - `REDACTION_VERSION`: ルールバージョン管理

- **conversation_logger.py**: マスキング統合
  - `append_conversation()` でシークレットを自動マスク
  - マスク時に `meta.redacted: true` と `meta.redaction_version` を付与

## マスク対象

| カテゴリ | パターン | 例 |
|---------|---------|-----|
| OpenAI | `sk-*`, `sk-proj-*` | sk-proj-abc123... |
| Anthropic | `sk-ant-*` | sk-ant-api03-... |
| AWS | `AKIA*`, `AWS_SECRET_*=` | AKIAIOSFODNN7EXAMPLE |
| Slack | `xox[baprs]-*` | xoxb-123456... |
| GitHub | `ghp_*`, `gho_*`, etc. | ghp_1234567890... |
| Google | `AIza*` | AIzaSyC-abc123... |
| JWT | `eyJ*.eyJ*.*` | eyJhbGci... |
| Private Key | `-----BEGIN...KEY-----` | PEM形式 |
| Auth Header | `Authorization:`, `X-Api-Key:` | Bearer token |
| DB URL | `postgres://`, `mongodb://` | 接続文字列 |
| Env Secret | `*_KEY=`, `*_SECRET=` | DATABASE_PASSWORD=... |
| Internal IP | `192.168.*:*`, `10.*:*` | 内部IP:ポート |
| Credit Card | Visa, MC, Amex, Discover | 4111-1111-... |
| JP Phone | `0[789]0-*-*` | 090-1234-5678 |
| My Number | `XXXX XXXX XXXX` | 1234 5678 9012 |

## 出力形式

```jsonl
{
  "ts": "...",
  "role": "user",
  "source": "ai_dispatch.openai",
  "content": "Use this API key: [REDACTED:openai_key] to connect",
  "meta": {
    "redacted": true,
    "redaction_version": "1.0"
  }
}
```

## 設計判断

- **マスク位置**: `append_conversation()` 直前（書き込み前）
- **理由**:
  - 永続化される前に確実にマスク
  - verify-runs/hash は壊れない（マスク後のハッシュ）
  - skip_masking オプションで例外対応可能

## REDACTION_VERSION

ルール変更時にバージョンを上げる。
- `1.0`: 初期リリース（v0.1.5）

## Commits

### infra-automation
- `8db5976` feat(conversation): add secrets/PII redaction
