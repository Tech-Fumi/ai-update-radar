# v0.3.0-learning-signals

ボタン押下イベントを収集し、推奨採用率を計測可能に。「推奨が当たっているか」の学習データを蓄積。

## Added

### 学習シグナル収集

ボタン押下時に `action_chosen` イベントを記録:

```json
{
  "ts": "2026-01-17T...",
  "event_type": "action_chosen",
  "run_id": "r_xxx",
  "trace_id": "tr_xxx",
  "recommended": "retry",
  "chosen": "rerun",
  "source": "ui",
  "accepted": false
}
```

| フィールド | 説明 |
|-----------|------|
| `recommended` | summary_card の推奨（retry/rerun/fix/noop） |
| `chosen` | 実際に押されたボタン（retry/rerun/fix） |
| `accepted` | 推奨通りに選択されたか（recommended == chosen） |

### 統計 API

`GET /learning/stats?since=7d`

```json
{
  "period_days": 7,
  "total_actions": 42,
  "acceptance_rate": 0.762,
  "by_recommended": {
    "retry": { "total": 15, "accepted": 14, "rate": 0.933 },
    "fix": { "total": 20, "accepted": 13, "rate": 0.65 }
  },
  "by_error_code": { ... },
  "confusion_matrix": {
    "retry": { "retry": 14, "rerun": 1 },
    "fix": { "fix": 13, "rerun": 5, "retry": 2 }
  }
}
```

| 指標 | 意味 |
|------|------|
| `acceptance_rate` | 推奨採用率（全体） |
| `by_recommended[X].rate` | 推奨 X の採用率 |
| `confusion_matrix` | 推奨 vs 実選択の混同行列 |

## 保存場所

```
logs/learning_signals.jsonl
```

- JSONL 形式で追記
- 既存の cleanup 方針に従う（30日 retention）

## 効果

| Before | After |
|--------|-------|
| 推奨の正しさが不明 | 採用率で検証可能 |
| ルール改善の根拠なし | 混同行列でズレを特定 |
| 感覚で調整 | データで調整 |

## 次のステップ

- `outcome_link` イベント追加（結果紐付け）
- 週次レポートへの組み込み
- ルール調整の自動提案

## Commits

### infra-automation
- `e93509e` feat(relay): add learning signals API (v0.3.0)

### ai-update-radar
- `9b76171` feat(frontend): add learning signals on button click (v0.3.0)
