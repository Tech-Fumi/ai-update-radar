# v0.3.1-decision-history

推奨を決定したルール ID（reason）を記録。外れたケースから「どのルールが原因か」が一直線で特定可能に。

## Added

### recommendation_reason フィールド

summary_card と learning_signals に reason を追加:

```json
{
  "recommendation": "retry",
  "recommendation_reason": "R2_TIMEOUT_RETRY"
}
```

### ルール ID 一覧

| ID | 条件 | 推奨 |
|----|------|------|
| `R0_FALLBACK_NOOP` | その他 | noop |
| `R1_COMPLETED_NOOP` | completed + passed | noop |
| `R2_TIMEOUT_RETRY` | failed + TIMEOUT | retry |
| `R3_MCP_CALL_RERUN` | failed + mcp_call（非TIMEOUT） | rerun |
| `R4_HAS_CHANGES_FIX` | failed + changes > 0 | fix |
| `R5_FAILED_DEFAULT_FIX` | failed（その他） | fix |

### 学習シグナルに reason 追加

```json
{
  "event_type": "action_chosen",
  "recommended": "retry",
  "reason": "R2_TIMEOUT_RETRY",
  "chosen": "rerun",
  "accepted": false
}
```

## 効果

| Before | After |
|--------|-------|
| 外れたセルを見る | 該当 run → reason でルール特定 |
| 「なぜ retry 推奨？」が不明 | R2_TIMEOUT_RETRY で即判明 |
| ルール改善が手探り | reason 別に集計可能 |

## 改善サイクル

```
confusion_matrix で外れを検出
    ↓
該当 run を開く
    ↓
recommendation_reason を確認
    ↓
ルールの条件を修正
    ↓
テストで固定
```

## Tests

既存 7 テストを更新（reason 検証追加）

## Commits

### infra-automation
- `43612ab` feat(summary-card): add recommendation_reason (v0.3.1)

### ai-update-radar
- `62cac0a` feat(frontend): include recommendation_reason in signals (v0.3.1)
