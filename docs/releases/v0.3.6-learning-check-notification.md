# v0.3.6-learning-check-notification

å­¦ç¿’çµ±è¨ˆã®æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ï¼†Discord é€šçŸ¥ï¼ˆPhase1.5: æ¡ç”¨ç‡ãƒ™ãƒ¼ã‚¹ + é€£ç¶šè¿½è·¡ï¼‰ã€‚

## Added

### check-learning-stats.sh

æ—¥æ¬¡ã§ `/learning/stats?since=24h` ã‚’ãƒã‚§ãƒƒã‚¯ã—ã€çŠ¶æ…‹ã«å¿œã˜ã¦ Discord é€šçŸ¥ã€‚

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯:**

| çŠ¶æ…‹ | æ¡ä»¶ | é€šçŸ¥ |
|------|------|:----:|
| GOOD | R2 æ¡ç”¨ç‡ >= 80% ã‹ã¤ mismatch <= 3 | âœ… |
| BAD | R2 æ¡ç”¨ç‡ < 50% ã¾ãŸã¯ mismatch >= 10 | âœ… |
| INFO | ãã®ä»– | âŒ |

**Phase1 ã®åˆ¶ç´„:**
- `æ¡ç”¨ç‡`ï¼ˆacceptance rateï¼‰ã‚’ä½¿ç”¨
- `æˆåŠŸç‡`ï¼ˆsuccess rateï¼‰ã¯æœªå®Ÿè£…ï¼ˆoutcome_link å¿…è¦ï¼‰

### Phase1.5: é€£ç¶š GOOD è¿½è·¡ + ONå€™è£œé€šçŸ¥

**state/learning_check_state.json:**
```json
{
  "good_streak_days": 5,
  "last_day": "2026-01-17",
  "last_state": "GOOD"
}
```

**å‹•ä½œ:**
- GOOD ãŒé€£ç¶šã™ã‚‹ã¨ `good_streak_days` ãŒã‚¤ãƒ³ã‚¯ãƒªãƒ¡ãƒ³ãƒˆ
- 7æ—¥é€£ç¶šã§ã€ŒONå€™è£œé€šçŸ¥ã€ã‚’ Discord ã«é€ä¿¡
- é€šçŸ¥ã«ã¯æ‰‹å‹• ON ã®ã‚³ãƒãƒ³ãƒ‰ãŒå«ã¾ã‚Œã‚‹

**ONå€™è£œé€šçŸ¥ã®å†…å®¹:**
```
ğŸ¯ [learning-check] ONå€™è£œé€šçŸ¥

æ¡ç”¨ç‡ãƒ™ãƒ¼ã‚¹ã§ GOOD ãŒ 7æ—¥é€£ç¶šã€‚
âš ï¸ æˆåŠŸç‡ã¯æœªè¨ˆæ¸¬ï¼ˆPhase2 ã§å®Ÿè£…äºˆå®šï¼‰ã€‚

ONã™ã‚‹ãªã‚‰ä»¥ä¸‹ã‚’æ‰‹å‹•ã§å¤‰æ›´:
- config/auto_action_policy.yaml ã® global.enabled: true, dry_run: false
- sudo systemctl restart claude-relay-bridge
```

### systemd ã‚¿ã‚¤ãƒãƒ¼

```
check-learning-stats.timer: æ¯æ—¥ 04:00 ã«å®Ÿè¡Œ
check-learning-stats.service: oneshot ã§é€šçŸ¥ã‚¹ã‚¯ãƒªãƒ—ãƒˆå®Ÿè¡Œ
```

**ç’°å¢ƒå¤‰æ•°:**

| å¤‰æ•° | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ | èª¬æ˜ |
|------|-----------|------|
| RELAY_URL | å¿…é ˆ | http://localhost:8050 |
| DISCORD_WEBHOOK_URL | å¿…é ˆ | ~/.env ã‹ã‚‰èª­ã¿è¾¼ã¿ |
| SINCE | 24h | é›†è¨ˆæœŸé–“ |
| GOOD_RATE | 0.80 | GOOD åˆ¤å®šé–¾å€¤ |
| BAD_RATE | 0.50 | BAD åˆ¤å®šé–¾å€¤ |

## æœ‰åŠ¹åŒ–æ‰‹é †

```bash
# ã‚·ãƒ³ãƒœãƒªãƒƒã‚¯ãƒªãƒ³ã‚¯ä½œæˆ
sudo ln -sf /home/fumi/infra-automation/claude-relay-bridge/systemd/check-learning-stats.service /etc/systemd/system/
sudo ln -sf /home/fumi/infra-automation/claude-relay-bridge/systemd/check-learning-stats.timer /etc/systemd/system/

# ãƒªãƒ­ãƒ¼ãƒ‰ï¼†æœ‰åŠ¹åŒ–
sudo systemctl daemon-reload
sudo systemctl enable --now check-learning-stats.timer

# ç¢ºèª
systemctl list-timers check-learning-stats.timer
```

## æ‰‹å‹•ãƒ†ã‚¹ãƒˆ

```bash
# ç’°å¢ƒå¤‰æ•°ã‚’è¨­å®šã—ã¦å®Ÿè¡Œ
export RELAY_URL=http://localhost:8050
export DISCORD_WEBHOOK_URL="..."
export SINCE=24h
/home/fumi/infra-automation/scripts/check-learning-stats.sh
```

## Phase2 äºˆå®š

outcome_link ã‚’å®Ÿè£…å¾Œ:
- æ¡ç”¨ç‡ â†’ æˆåŠŸç‡ï¼ˆå®Ÿéš›ã®çµæœãƒ™ãƒ¼ã‚¹ï¼‰
- ç²¾åº¦ãŒä¸ŠãŒã‚Šã€ON åˆ¤æ–­ã®æ ¹æ‹ ãŒå¼·åŒ–ã•ã‚Œã‚‹

## Commits

### infra-automation
- `9ec98ce` feat(relay): add Phase1 learning stats Discord notification
- `6b8d8cd` feat(relay): add Phase1.5 streak tracking and ON candidate notification
