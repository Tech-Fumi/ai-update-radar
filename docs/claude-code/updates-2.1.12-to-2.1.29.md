# Claude Code 新機能まとめ（v2.1.12 → v2.1.29）

作成日: 2026-02-01

v2.1.12 以降の主要な変更点をまとめています。

---

## 重要度: 高

### タスク管理システム（v2.1.16, v2.1.19）

新しいタスク管理システムが追加され、依存関係の追跡が可能に。

- `CLAUDE_CODE_ENABLE_TASKS` 環境変数で新旧システムの切り替えが可能
- タスクの削除機能（`TaskUpdate` ツール経由）
- セッションフォーク・巻き戻し機能（VSCode）

### 日本語 IME サポート（v2.1.21）

全角数字入力（zenkaku）が選択肢プロンプトで利用可能に。

### PR 連携強化（v2.1.20, v2.1.27）

- **PR レビュー状態インジケーター**: プロンプトフッターに PR の状態（approved, changes requested, pending, draft）を表示
- **マージ済み PR は紫色のインジケーター**（v2.1.23）
- `--from-pr` フラグ: 特定の GitHub PR にリンクされたセッションを再開
- `gh pr create` で作成されたセッションは自動的に PR にリンク

### 権限システムの修正（v2.1.27）

**重要な仕様変更**: content-level `ask` が tool-level `allow` より優先されるように。
tu
- 以前: `allow: ["Bash"], ask: ["Bash(rm *)"]` はすべての bash コマンドを許可
- **現在**: `rm` コマンドは適切にプロンプトが表示される

---

## 重要度: 中

### カスタマイズ機能

| バージョン   | 機能                | 説明                         |
| ------- | ----------------- | -------------------------- |
| v2.1.23 | `spinnerVerbs` 設定 | スピナーの動詞をカスタマイズ可能           |
| v2.1.20 | `/copy` コマンド      | 全ユーザーに解放                   |
| v2.1.20 | `/sandbox` コマンド強化 | 依存関係ステータスとインストール手順を表示      |
| v2.1.19 | カスタムコマンド引数        | `$0`, `$1` 等のショートハンド構文     |
| v2.1.20 | `--add-dir` フラグ   | 追加ディレクトリから CLAUDE.md を読み込み |

### 開発者向け機能

| バージョン | 機能 | 説明 |
|-----------|------|------|
| v2.1.27 | デバッグログ強化 | ツール呼び出しの失敗・拒否をログに記録 |
| v2.1.21 | Python venv 自動有効化 | VSCode で正しい Python インタプリタを自動選択 |
| v2.1.21 | ファイル操作ツール優先 | `cat`, `sed`, `awk` より Read/Edit/Write を優先 |
| v2.1.20 | Markdown リッチフォーマット | チームメイトメッセージで bold, code blocks, lists 等をサポート |

### UI/UX 改善

| バージョン | 機能 | 説明 |
|-----------|------|------|
| v2.1.23 | ターミナル描画性能 | スクリーン描画のパフォーマンス向上 |
| v2.1.21 | 進捗インジケーター | "Reading…" → "Read" の状態表示 |
| v2.1.20 | タスクリスト動的サイズ | ターミナル高さに応じて自動調整 |
| v2.1.20 | vim 矢印キー履歴ナビ | カーソルが移動できない時に履歴ナビゲーション |
| v2.1.20 | 思考中アニメーション | シマーアニメーション追加 |

---

## 重要度: 低（バグ修正）

### パフォーマンス修正

| バージョン | 修正内容 |
|-----------|----------|
| v2.1.29 | `saved_hook_context` 付きセッション再開時の起動パフォーマンス |
| v2.1.23 | プロンプトキャッシング競合状態（400 エラー） |
| v2.1.21 | 大きな出力トークン制限モデルでの auto-compact 早期発火 |
| v2.1.16 | サブエージェント多用セッション再開時の OOM クラッシュ |

### プラットフォーム別修正

| バージョン | プラットフォーム | 修正内容 |
|-----------|----------------|----------|
| v2.1.27 | Windows | `.bashrc` 持ちユーザーの bash 実行失敗 |
| v2.1.27 | Windows | 子プロセス起動時のコンソールウィンドウ点滅 |
| v2.1.21 | Windows | VSCode でのファイル検索 |
| v2.1.16 | Windows | サイドバー表示の競合状態 |
| v2.1.25 | Bedrock/Vertex | beta ヘッダー検証エラー（`CLAUDE_CODE_DISABLE_EXPERIMENTAL_BETAS=1` で回避） |
| v2.1.27 | OAuth | 長時間セッション後の 401 エラー |
| v2.1.23 | mTLS/Proxy | 企業プロキシ・クライアント証明書での接続問題 |
| v2.1.17 | CPU | AVX 命令非対応プロセッサでのクラッシュ |

### その他の修正

| バージョン | 修正内容 |
|-----------|----------|
| v2.1.23 | ripgrep タイムアウト時のエラー報告 |
| v2.1.23 | タブ補完時の入力フィールド更新 |
| v2.1.21 | シェル補完キャッシュファイルの切り詰め |
| v2.1.21 | ツール実行中断時のセッション再開 API エラー |
| v2.1.20 | ワイド文字（絵文字、CJK）の描画アーティファクト |
| v2.1.20 | MCP ツール応答の Unicode JSON パースエラー |
| v2.1.19 | ターミナル終了時のプロセス残存 |

---

## バージョン履歴

| バージョン | リリース日 | 主な変更 |
|-----------|-----------|----------|
| v2.1.29 | 2026-01-31 | セッション再開パフォーマンス修正 |
| v2.1.27 | 2026-01-30 | --from-pr, 権限ロジック修正, デバッグログ強化 |
| v2.1.25 | 2026-01-29 | Bedrock/Vertex beta ヘッダー修正 |
| v2.1.23 | 2026-01-29 | スピナーカスタマイズ, mTLS 修正, PR ステータス表示 |
| v2.1.22 | 2026-01-28 | 非インタラクティブモードの構造化出力修正 |
| v2.1.21 | 2026-01-28 | 日本語 IME, Python venv 自動有効化 |
| v2.1.20 | 2026-01-27 | PR レビューインジケーター, タスク削除, /copy 全開放 |
| v2.1.19 | 2026-01-23 | タスク管理強化, カスタムコマンド引数 |
| v2.1.17 | 2026-01-22 | AVX 命令クラッシュ修正 |
| v2.1.16 | 2026-01-22 | 新タスク管理システム, VSCode プラグイン管理 |

---

## AIOS 活用

| 機能 | 活用度 | 活用先 |
|------|:------:|--------|
| `--from-pr` | ★★★ | session-manager 連携、レビュー対応自動化 |
| Task* ツール | ★★☆ | todo-write.md ルール強化 |
| PR ステータス | ★★☆ | レビュー状態監視 |

## ルール更新

- ✅ `hash-cache.md`: native installer 対応
- ✅ `context-recovery.md`: `--from-pr` セクション追加
- ✅ `todo-write.md`: Task* ツール追加
- ✅ `sync-claude-code.md`: npm → claude install

---

## アップグレード推奨

**推奨**: v2.1.29 への更新

```bash
claude install latest
hash -r
claude --version
```

主な理由:
1. 権限システムの重要な修正（セキュリティ）
2. 日本語 IME サポート
3. パフォーマンス改善
4. PR 連携機能の強化
